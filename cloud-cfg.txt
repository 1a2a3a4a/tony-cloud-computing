#cloud-config

apt_update: true
apt_upgrade: true
package_reboot_if_required: true
packages:
 - cowsay
 - python-pip
 - python-dev
 - rabbitmq-server
 - build-essential
 - cowsay
 - python-openstackclient
 - emacs24
byobu_default: system 

write_files:
  - path: /home/ubuntu/cowsay-app.py
    content: |
      from flask import Flask, jsonify
      import subprocess
      import sys
      app = Flask(__name__)
      @app.route('/cowsay/api/v1.0/saysomething', methods=['GET'])
      def cow_say():
          data=subprocess.check_output(["cowsay","Hello student"])
          return data
      if __name__ == '__main__':
          app.run(host='0.0.0.0',debug=True)
  - path: /home/ubuntu/clone.sh
    content: |
      echo 'cloneing my repos...'
      git clone https://github.com/1a2a3a4a/tony-cloud-computing
      git clone https://github.com/1a2a3a4a/ACC-1

runcmd:
 - echo "export PATH=$PATH:/usr/games" >> /home/ubuntu/.bashrc  
 - source /home/ubuntu/.bashrc
 - pip install Flask
 - pip install celery
 - pip install flower
 - git config --global user.email "tonywang3334@gmail.com"
 - apt-get update
 - curl -fsSL https://get.docker.com/ | sh
 - curl -fsSL https://get.docker.com/gpg | sudo apt-key add -
 
